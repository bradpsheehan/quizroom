= content_for :extra_scripts do
  = javascript_include_tag "http://localhost:9292/faye.js"

  :javascript
    $(document).ready( function() {
      var faye = new Faye.Client('http://localhost:9292/faye');

    var channel = $('#chat').data("channel");
    faye.subscribe("/#{@chat.public_channel}", function(data) {
      if(data.isQuestion) {
        $("#chat").append("<li>" + data.sender + ": "+data.message+"</li>");
      }else if(data.token === "#{current_user.token}") {
        console.log("Your answer is " + data.answer)
      }

    });

    $("form#answer").on("submit", function() {

      var publicChannel;
      var selectedAnswer = $(this).find('input[type="radio"]:checked').val();

      if(selectedAnswer) {
        $(this).find('input[type="submit"]').remove();

        publishChannel = $("#publish_channel").val();

        faye.publish("/#{@chat.public_channel}", {
          message: $("#message").val(),
          sender: "#{current_user.first_name} #{current_user.last_name}",
          token: "#{current_user.token}",
          answer: selectedAnswer

        });
        faye.publish("/#{@chat.teacher_channel}", {
          message: $("#message").val(),
          sender: "#{current_user.first_name} #{current_user.last_name}",
          token: "#{current_user.token}",
          answer: selectedAnswer

        });

        $("form")[0].reset();
      } else {
        console.log("You must select an answer before submitting");
      }
      return false;
    });
