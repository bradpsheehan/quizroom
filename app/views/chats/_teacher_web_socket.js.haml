= content_for :extra_scripts do
  = javascript_include_tag "http://localhost:9292/faye.js"
  = javascript_include_tag "socket"

  :javascript
    var exampleQuestion = {
      id: 5,
      question: "Bacon ipsum dolor sit amet tri-tip short ribs prosciutto beef ribs, beef turkey ham shoulder flank t-bone. Sirloin cow frankfurter ham hock leberkas turducken. Turkey biltong tail cow filet mignon doner beef ribs?",
      answers: [
        {
          id: 1,
          answer: "Tongue swine capicola filet mignon. Short ribs doner pork bresaola.",
        },
        {
          id: 2,
          answer: "Tongue swine capicola filet mignon. Short ribs doner pork bresaola.Tri-tip tail pancetta, short loin ball tip pork belly swine strip steak. Shankle ham shoulder, short ribs jerky strip steak drumstick bresaola.",
          correctAnswer: true

        },
        {
          id: 3,
          answer: "Ground round t-bone tenderloin, flank turkey meatloaf pancetta chuck. Corned beef pork belly leberkas, meatloaf pancetta sausage turducken t-bone beef shankle doner shoulder.",
        },
        {
          id: 4,
          answer: "None of the above",
        },
      ],
      next_question_path: "path_to_get_the_next_question"
    };

    var exampleStudentQuestion = {
      quizName: "A Quiz",
      id: 5,
      submitPath: "http://quizzical.com/quizzes/1/questions/1/submissions",
      question: "Bacon ipsum dolor sit amet tri-tip short ribs prosciutto beef ribs, beef turkey ham shoulder flank t-bone. Sirloin cow frankfurter ham hock leberkas turducken. Turkey biltong tail cow filet mignon doner beef ribs?",
      answers: [
        {
          id: 1,
          answer: "Tongue swine capicola filet mignon. Short ribs doner pork bresaola."
        },
        {
          id: 2,
          answer: "Tongue swine capicola filet mignon. Short ribs doner pork bresaola.Tri-tip tail pancetta, short loin ball tip pork belly swine strip steak. Shankle ham shoulder, short ribs jerky strip steak drumstick bresaola.",
          correctAnswer: true
        },
        {
          id: 3,
          answer: "Ground round t-bone tenderloin, flank turkey meatloaf pancetta chuck. Corned beef pork belly leberkas, meatloaf pancetta sausage turducken t-bone beef shankle doner shoulder."
        },
        {
          id: 4,
          answer: "None of the above"
        },
      ],
    };

    $(document).ready( function() {
      $("section.question").hide();

      var socket = Socket('http://localhost:9292/faye');
      var publicChannel = $('#chat').data("public-channel");
      var publishChannel = $("#publish_channel").val();
      var question = '';

      socket.subscribe("/#{@chat.public_channel}", function(data) {

        if(data.isQuestion) {
          $("section.question").show();
          question = data.question;

          $("h2#question-title").text(question.question);

          var answersLength = data.answers.length;
          var answerList = $("ul#possible-answers");
          answerList.children().remove();

          for(var i = 0; i < answersLength; i++) {
            var currentAnswer = data.answers[i];

            if(currentAnswer.correctAnswer){
              answerList.append("<li class='correct_answer'>"+ currentAnswer.answer+"</li>");
            } else {
              answerList.append("<li>"+currentAnswer.answer+"</li>");
            }
          }

        } else {
          $('.no-answer').remove();
          $("#chat").append("<li>"+data.sender+": "+data.answer+"</li>");
        }
      });

      $('#next-question').on('click', function() {

        socket.publish("/#{@chat.public_channel}", {
          question: $("#message").val(),
          isQuestion: true,
          sender: "Question"
        });

        $("form")[0].reset();
        return false;

      });

      $('#start-question').on('click', function() {
        //get the first question
        $.get("#{quiz_question_path(@quiz, @quiz.questions.first)}", function(data) {
          console.log(data);
          data.isQuestion = true;
          socket.publish("/#{@chat.public_channel}",data);
        });

        $(this).remove();

        return false;
      });
    });

